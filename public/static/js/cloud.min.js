function sendconf(t,e,n,i,s){$.post("store.php?m=cloud&a=sendconf",{status:t,rid:e,sid:n,ver:s},function(o){if(1==o.fstatus)1==o.astatus?$("#status_message").html(o.content):$("#tips_message").html(o.content);else{var a="<p style='font-size:12px;color:red; border-top:1px dashed #ddd; margin:10px 0 0; padding:10px 0 0;'>"+o.content+"</p>";$("#tips_message").html(a),$("#status_message").html('<font color="red">未启动</font>'),$("#refresh").attr("disabled",!1),1==$("#install").attr("k")&&$("#upapp").show()}1==o.fstatus&&(eInterval=setInterval(function(){checktaskstatus(e,n,i,t,s)},2e3))},"json")}function checktaskstatus(t,e,n,i,s){return eInterval&&count>=maxInterval?($("#tips_message").html("请求超时，请稍后再试"),$("#refresh").attr("disabled",!1),clearInterval(eInterval),!1):(count+=1,$.post("store.php?m=cloud&a=checktaskstatus",{rid:t,sid:e,status:i},function(o){if("200"==o.info)if(clearInterval(eInterval),1==o.s){if($("#tips_message").html("应用安装完成"),setTimeout("cleantips()",3e3),$("#uninstallconfigapp").show(),null!=document.getElementById("saveconfig2")&&$("#saveconfig2").attr("disabled",!1),null!=document.getElementById("install"))1==$("#install").attr("k")?$("#upapp").hide():1==denyuninstall?$("#install").remove():(document.getElementById("install").setAttribute("value","卸  载"),document.getElementById("install").setAttribute("v","0"),document.getElementById("install").setAttribute("id","uninstall"),document.getElementById("uninstall").disabled=!1);else if(null!=document.getElementById("saveconfig"))if(1==$("#saveconfig1").attr("k"))$("#upapp").hide();else{1==denyuninstall?$("#saveconfig").remove():(document.getElementById("saveconfig").setAttribute("value","卸  载"),document.getElementById("saveconfig").setAttribute("v","0"),document.getElementById("saveconfig").setAttribute("id","uninstallconfigapp"),document.getElementById("uninstallconfigapp").disabled=!1);var a='<input type="button" value="应用" id="saveconfig2" class="sb" onclick="setservconfig()">';$("#set").append(a)}if(1==o.as){if($("#st").remove(),1==o.stat){var r='<div id="st" style="position:absolute;left:185px; font-size:12px;">运行状态：';r+='<span id="status_message" style="font-size:12px;">',r+='<font color="green">运行中</font>',r+="</span>",r+='<div style="margin-top:-18px;margin-left:120px;">',r=r+'<input type="button" value="刷新状态" id="refresh" class="sb" onclick="refreshstat()">'+"&nbsp;",r+='<input type="button" value="暂停服务" id="stop" class="sb" onclick="stopserv()">',r+="</div></div>"}else if(2==o.stat){var r='<div id="st" style="position:absolute;left:185px; font-size:12px;">运行状态：';r+='<span id="status_message" style="font-size:12px;">',r+='<font color="green">拨号中</font>',r+="</span>",r+='<div style="margin-top:-18px;margin-left:120px;">',r=r+'<input type="button" value="刷新状态" id="refresh" class="sb" onclick="refreshstat()">'+"&nbsp;",r+='<input type="button" value="暂停服务" id="stop" class="sb" onclick="stopserv()">',r+="</div></div>"}else if(3==o.stat){var r='<div id="st" style="position:absolute;left:185px; font-size:12px;">运行状态：';r+='<span id="status_message" style="font-size:12px;">',r+='<font color="green">未知</font>',r+="</span>",r+='<div style="margin-top:-18px;margin-left:120px;">',r+='<input type="button" value="刷新状态" id="refresh" class="sb" onclick="refreshstat()">',r+="</div></div>"}else if(4==o.stat){var r='<div id="st" style="position:absolute;left:185px; font-size:12px;">运行状态：';r+='<span id="status_message" style="font-size:12px;">',r+='<font color="red">流量用光</font>',r+="</span>",r+='<divstyle="margin-top:-18px;margin-left:120px;">',r+='<input type="button" value="刷新状态" id="refresh" class="sb" onclick="refreshstat()">',r+="</div></div>"}else if(0==o.stat){var r='<div id="st" style="position:absolute;left:185px; font-size:12px;">运行状态：';r+='<span id="status_message" style="font-size:12px;">',r+='<font color="red">未启动</font>',r+="</span>",r+='<div style="margin-top:-18px;margin-left:120px;">',r=r+'<input type="button" value="刷新状态" id="refresh" class="sb" onclick="refreshstat()">'+"&nbsp;",r+='<input type="button" value="启动服务" id="start" class="sb" onclick="startserv()">',r+="</div></div>"}else if(5==o.stat){var r='<div id="st" style="position:absolute;left:185px; font-size:12px;">运行状态：';r+='<span id="status_message" style="font-size:12px;">',r+='<font color="red">系统维护</font>',r+="</span>",r+='<div style="margin-top:-18px;margin-left:120px;">',r=r+'<input type="button" value="刷新状态" id="refresh" class="sb" onclick="refreshstat()">'+"&nbsp;",r+='<input type="button" value="启动服务" id="start" class="sb" onclick="startserv()">',r+="</div></div>"}else if(6==o.stat){var r='<div id="st" style="position:absolute;left:185px; font-size:12px;">运行状态：';r+='<span id="status_message" style="font-size:12px;">',r=r+'<font color="red">'+o.msg+"</font>",r+="</span>",r+='<div style="margin-top:-18px;margin-left:120px;">',r+='<input type="button" value="刷新状态" id="refresh" class="sb" onclick="refreshstat()">',r+="</div></div>"}$("#detail-list").append(r)}}else if(0==o.s)$("#tips_message").html("应用已经卸载，期待您再次安装"),setTimeout("cleantips()",3e3),null!=document.getElementById("uninstall")?(document.getElementById("uninstall").setAttribute("value","立即安装"),document.getElementById("uninstall").setAttribute("v","1"),document.getElementById("uninstall").setAttribute("id","install"),$("#upapp").remove(),document.getElementById("install").disabled=!1):(document.getElementById("uninstallconfigapp").setAttribute("value","立即安装"),document.getElementById("uninstallconfigapp").setAttribute("v","1"),document.getElementById("uninstallconfigapp").setAttribute("id","saveconfig"),$("#upapp").remove(),document.getElementById("saveconfig").disabled=!1,$("#saveconfig2").remove()),$("#st").hide();else if(2==o.s){if($("#status_message").html("刷新成功"),1==o.stat)$("#status_message").html('<font color="green">运行中</font>'),$("#stop").show(),$("#start").hide(),$("#stop").attr("disabled",!1),$("#refresh").attr("disabled",!1),$("#uninstall").attr("disabled",!1);else if(2==o.stat)$("#status_message").html('<font color="green">拨号中</font>'),$("#stop").show(),$("#start").hide(),$("#stop").attr("disabled",!1),$("#refresh").attr("disabled",!1),$("#uninstall").attr("disabled",!1);else if(3==o.stat)$("#status_message").html('<font color="green">未知</font>'),$("#refresh").attr("disabled",!1),$("#uninstall").attr("disabled",!1);else if(0==o.stat)$("#status_message").html('<font color="red">未启动</font>'),$("#start").show(),$("#stop").hide(),$("#start").attr("disabled",!1),$("#refresh").attr("disabled",!1),$("#uninstall").attr("disabled",!1);else if(4==o.stat)$("#status_message").html('<font color="red">流量用光</font>'),$("#start").show(),$("#stop").hide(),$("#refresh").attr("disabled",!1),$("#uninstall").attr("disabled",!1);else if(5==o.stat)$("#status_message").html('<font color="red">系统维护</font>'),$("#start").show(),$("#start").attr("disabled",!1),$("#refresh").attr("disabled",!1),$("#uninstall").attr("disabled",!1);else if(6==o.stat){var r='<font color="red">'+o.msg+"</font>";$("#status_message").html(r),$("#refresh").attr("disabled",!1),$("#uninstall").attr("disabled",!1)}$("#refresh").show(),$("#saveconfig2").show(),$("#uninstallconfigapp").show()}else 3==o.s?(sendconf(2,t,e,n,s),appstat=1,$("#status_message").html("服务启动")):4==o.s&&(sendconf(2,t,e,n,s),appstat=0,$("#status_message").html("服务关闭"));else"400"==o.info&&(clearInterval(eInterval),2==o.op?(0==o.stat?$("#start").show():1==o.stat?$("#stop").show():2==o.stat&&$("#stop").show(),$("#refresh").attr("disabled",!1)):3==o.status?$("#start").attr("disabled",!1):4==o.status&&$("#stop").attr("disabled",!1),2==i?$("#status_message").html("刷新失败"):($("#tips_message").html(o.c),setTimeout("cleantips()",3e3)),$("#refresh").show(),$("#saveconfig").show(),$("#uninstallconfigapp").show())},"json"),void 0)}function closedialog(){var t=art.dialog.list;for(var e in t)t[e].close()}function install(t,e,n,i){var s=document.getElementById(n).getAttribute("v");art.dialog.open("store.php?m=cloud&a=appinstall&rid="+t+"&sid="+e+"&version="+i+"&status="+s+"&i="+n,{id:"install_div",width:800,lock:!0,title:"登录"})}function uninstall(t,e,n,i){art.dialog({lock:!1,title:"卸载应用程序",content:"是否卸载该应用程序",button:[{name:"确定",callback:function(){closedialog(),$("#uninstall").attr("disabled",!0),$("#uninstallconfigapp").attr("disabled",!0),sendconf(0,t,e,n,i)}},{name:"取消",callback:function(){$("#saveconfig2").show(),$("#refresh").attr("disabled",!1),$("#start").attr("disabled",!1),$("#stop").attr("disabled",!1),closedialog()},focus:!0}]})}function showmsg(t,e){art.dialog({iconurl:"https://app.hiwifi.com/static/images/icons/",icon:"loading",lock:!0,background:"#ddd",opacity:.1,title:t,content:e})}function showmsg2(t,e){art.dialog({lock:!0,background:"#ddd",opacity:.1,title:t,content:e})}function login(){art.dialog.open("store.php?m=user&a=openlogin",{id:"login_div",width:600,height:190,title:"登录"})}function cleantips(){$("#tips_message").html(""),null!=document.getElementById("setconfig")&&$("#setconfig").show()}function showctrl(t){null!=document.getElementById("start")&&0==t&&$("#start").show(),null==document.getElementById("stop")||1!=t&&2!=t||$("#stop").show(),(null!=document.getElementById("refresh")||4==t)&&$("#refresh").show(),null!=document.getElementById("uninstallconfigapp")&&$("#uninstallconfigapp").show(),null!=document.getElementById("saveconfig")&&$("#saveconfig").attr("disabled",!1),null!=document.getElementById("saveconfig2")&&$("#saveconfig2").attr("disabled",!1)}function checkstatus(t,e,n,i,s,o){$.post("store.php?m=cloud&a=checktaskstatus",{rid:t,sid:e,status:i},function(n){taskcount++,"200"==n.info?(clearInterval(flg),$("#go_back").show(),1==n.s?($("#tips_message").html("应用安装完成"),11==e?$("#b_url").attr("href","store.php?m=goabroad&a=pluginsinfo&rid="+t+"&sid="+e):28==e?$("#b_url").attr("href","store.php?m=dmz&a=info&rid="+t+"&sid="+e):37==e?$("#b_url").attr("href","store.php?m=hosts&a=info&rid="+t+"&sid="+e):$("#b_url").attr("href","store.php?m=plugins&a=info&rid="+t+"&sid="+e)):0==n.s&&($("#tips_message").html("应用已经卸载，期待您再次安装"),o&&$("#delconf").show(),$("#b_url").attr("href","store.php?m=router&a=app&rid="+t))):"400"==n.info&&(clearInterval(flg),$("#tips_message").html(n.c),$("#go_back").show())},"json")}var eInterval=!1,count=0,maxInterval=30,taskcount=0,maxtaskcount=30,flg=!1;